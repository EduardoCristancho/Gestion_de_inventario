generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/xxx-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  company_id   Int         @id @default(autoincrement())
  visibility   Boolean     @default(true)
  company_logo String?
  name         String
  tax_id       String?     @unique
  email        String?     @unique
  address      String?
  phone        String?
  customers    Customer[]
  products     Product[]
  suppliers    Supplier[]
  users        User[]
  warehouses   Warehouse[]
}

model Warehouse {
  warehouse_id Int           @id @default(autoincrement())
  company_id   Int
  name         String
  email        String?
  address      String?
  phone        String?
  visibility   Boolean       @default(true)
  productlist  ProductList[]
  stock        Stock[]
  users        User[]
  company      Company       @relation(fields: [company_id], references: [company_id], onDelete: Cascade)
}

model User {
  user_id        Int            @id @default(autoincrement())
  company_id     Int
  role_id        Int
  warehouse_id   Int
  visibility     Boolean        @default(true)
  username       String         @unique
  password       String
  user_photo     String?
  revoked_tokens RevokedToken[]
  sales          Sale[]
  company        Company        @relation(fields: [company_id], references: [company_id], onDelete: Cascade)
  role           Role           @relation(fields: [role_id], references: [role_id], onDelete: SetNull)
  warehouse      Warehouse      @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: SetNull)
}

model Supplier {
  supplier_id   Int            @id @default(autoincrement())
  company_id    Int
  name          String
  RIF           String
  email         String?
  address       String?
  phone         String?
  visibility   Boolean       @default(true)
  model_product ModelProduct[]
  company       Company        @relation(fields: [company_id], references: [company_id], onDelete: Cascade)
}

model Customer {
  customer_id Int     @id @default(autoincrement())
  company_id  Int
  first_name  String
  last_name   String?
  address     String?
  email       String?
  phone       String?
  visibility  Boolean @default(true)
  id_card     String
  company     Company @relation(fields: [company_id], references: [company_id], onDelete: Cascade)
  sales       Sale[]
}

model Product {
  product_id    Int            @id @default(autoincrement())
  company_id    Int
  visibility    Boolean        @default(true)
  name          String
  description   String?
  model_product ModelProduct[]
  company       Company        @relation(fields: [company_id], references: [company_id], onDelete: Cascade)
}

model ModelProduct {
  model_product_id Int           @id @default(autoincrement())
  product_id       Int
  supplier_id      Int?
  state_id         Int           @default(1)
  visibility       Boolean       @default(true)
  photo            String?
  sku              String
  name             String
  description      String?
  cost             Decimal?      @db.Decimal(10, 2)
  price            Decimal       @db.Decimal(10, 2)
  product          Product       @relation(fields: [product_id], references: [product_id], onDelete: Cascade)
  state            State         @relation(fields: [state_id], references: [state_id], onDelete: SetNull)
  supplier         Supplier?     @relation(fields: [supplier_id], references: [supplier_id])
  product_list     ProductList[]
  stock            Stock[]
}

model Role {
  role_id     Int     @id @default(autoincrement())
  name        String  @unique
  description String?
  users       User[]
}

model ProductList {
  product_list_id  Int          @id @default(autoincrement())
  sale_id          Int
  quantity         Int
  unit_price       Decimal      @db.Decimal(10, 2)
  total_price      Decimal      @db.Decimal(10, 2)
  model_product_id Int
  warehouse_id     Int
  modelproduct     ModelProduct @relation(fields: [model_product_id], references: [model_product_id])
  sale             Sale         @relation(fields: [sale_id], references: [sale_id], onDelete: Cascade)
  warehouse        Warehouse    @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: SetNull)
}

model Stock {
  stock_id          Int           @id @default(autoincrement())
  warehouse_id      Int
  stock_movement_id Int
  quantity          Int
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  model_product_id  Int
  model_product     ModelProduct  @relation(fields: [model_product_id], references: [model_product_id], onDelete: Cascade)
  stock_movement    StockMovement @relation(fields: [stock_movement_id], references: [stock_movement_id], onDelete: SetNull)
  warehouse         Warehouse     @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: Cascade)
}

model StockMovement {
  stock_movement_id Int     @id @default(autoincrement())
  name              String
  description       String?
  stock             Stock[]
}

model Sale {
  sale_id       Int           @id @default(autoincrement())
  user_id       Int
  customer_id   Int?
  state_id      Int           @default(2)
  total_amount  Decimal       @db.Decimal(10, 2)
  date          DateTime      @default(now())
  product_list  ProductList[]
  customer      Customer?     @relation(fields: [customer_id], references: [customer_id])
  state         State         @relation(fields: [state_id], references: [state_id], onDelete: SetNull)
  user          User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  sale_payments SalePayment[]
}

model SalePayment {
  sale_payment_id Int         @id @default(autoincrement())
  sale_id         Int
  exchange_rate   Decimal?    @db.Decimal(10, 2)
  amount_paid_usd Decimal?    @db.Decimal(10, 2)
  date            DateTime    @default(now())
  payment_coin_id Int
  sale            Sale        @relation(fields: [sale_id], references: [sale_id], onDelete: Cascade)
  PaymentCoin     PaymentCoin @relation(fields: [payment_coin_id], references: [payment_coin_id], onDelete: Cascade, map: "fk_sale_paiment_coin")
}

model PaymentCoin {
  payment_coin_id   Int           @id @default(autoincrement())
  payment_method_id Int
  currency_id       Int
  Currency          Currency      @relation(fields: [currency_id], references: [currency_id], onDelete: Cascade, map: "fk_currency")
  PaymentMethod     PaymentMethod @relation(fields: [payment_method_id], references: [payment_method_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_payment")
  SalePayment       SalePayment[]
}

model PaymentMethod {
  payment_method_id Int           @id @default(autoincrement())
  name              String
  icon              String?
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  PaymentCoin       PaymentCoin[]
}

model Currency {
  currency_id   Int           @id @default(autoincrement())
  code          String?       @unique
  icon          String?
  name          String
  symbol        String?
  exchange_rate Decimal?      @db.Decimal(10, 2)
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  PaymentCoin   PaymentCoin[]
}

model State {
  state_id     Int            @id @default(autoincrement())
  name         String         @unique
  modelproduct ModelProduct[]
  sales        Sale[]
}

model RevokedToken {
  revoked_token_id Int      @id @default(autoincrement())
  token            String
  user_id          Int
  revoked_at       DateTime
  reason           String
  user             User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}
